---
title: "DataProcessing"
format: html
editor: visual
---

# Script de chargement et de nettoyage des données

## Chargement des librairies

```{r, warning=FALSE}
library(tidyverse)
library(fuzzywuzzyR)
library(fuzzyjoin)
library(stringdist)
```

## chargement des données

```{r warning=FALSE}
data <- read_delim("../data/ECHO_DU_MARCHE.csv")
data_cat <- read_delim("../data/catProduit.csv")
data |> head(6)
data_cat |> head(6)


```

## Ajout des catergories aux données

### Méthode 1

```{r warning=FALSE}

data$PRODUITS <- tolower(trimws(data$PRODUITS))
data_cat$Produits <- tolower(trimws(data_cat$Produits))

unique(data$PRODUITS)

#dist <- stringdist("igname",str_to_lower(data_cat$Produits), method ="soundex")
#data_cat$Produits[dist==min(dist)]

 data_join <- stringdist_join(data, data_cat, 
                by = c("PRODUITS"="Produits"),
                mode = 'left', 
                 # use jw distance metric
                method = 'jw',
                max_dist =0.3, 
                )
data_join[,c("PRODUITS","Produits")]

length(data_join$Produits)

length(data_join$Produits[is.na(data_join$Produits)])

length(data_join$Produits)

```

### Méthode 2

```{r}

# Extract unique product values and convert to lowercase with trimmed whitespace


# Convert 'PRODUITS' column to lowercase with trimmed whitespace
datap<- tolower(trimws(unique(data$PRODUITS)))
datap <- tibble(datap)

data_cat$Produits <- tolower(trimws(data_cat$Produits))
class(datap)
class(data_cat)
datap

# Perform fuzzy join using stringdist_join with Jaro-Winkler distance metric
data_join <- stringdist_join(datap, data_cat, 
                             by = c("datap"="Produits"),
                             mode = 'left',
                             method = 'soundex')
data_join
unique.data.frame(data_join[,c("datap","Categories")])
# Check the number of NA values in the 'Produits' column of the joined data frame

length(data_join$Produits)

length(data_join$Categories[is.na(data_join$Categories)])

length(data_join$Produits)

```

```{r warning=FALSE}


```
